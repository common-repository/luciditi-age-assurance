/* (c) 2024 Luciditi Age Assurance - https://luciditi.co.uk/ */
!function(o){"use strict";const n={init:function(){n.initEvents();n.initActions()},initEvents:function(){if(0<o("#luciditi_aa_logo_upload").length){o("#luciditi_aa_logo_upload").click(function(){wp.media.editor.send.attachment=function(i,e){o("#luciditi_aa_logo_display").attr("src",e.url);o("#luciditi_aa_logo_display").show();o(".luciditi_aa_logo").val(e.url)};wp.media.editor.open(this);return!1});o("#luciditi_aa_logo_clear").click(function(){o("#luciditi_aa_logo_display").attr("src","");o("#luciditi_aa_logo_display").hide();o(".luciditi_aa_logo").val("");return!1})}if(0<o("#luciditi_aa_access_rules").length){var i=o("#luciditi_aa_access_rules");o("#luciditi_aa_add_rule").on("click",this.addAccessRule);o("#luciditi_aa_reset_rules").on("click",this.resetAccessRules);o(i).on("change",".luciditi_country_select",this.updateStateAndRegionVisibility);o(i).on("change",".luciditi_country_select, .luciditi_state_select, .luciditi_region_select",this.updateCountryAndStateAndRegionAvailability);o(i).on("click",".luciditi_aa_remove_rule",function(){o(this).closest(".luciditi_aa_access_rule").remove();n.updateCountryAndStateAndRegionAvailability()});o("#luciditi_aa_options_save").on("click",this.validateAccessRules);o(".luciditi_country_select").change()}},initActions:function(){0<o(".luciditi_aa_color").length&&o(".luciditi_aa_color").wpColorPicker();if("undefined"!=typeof mfConditionalFields&&0<o("[data-conditional-rules]").length){0<o("#luciditi_aa_options_form").length&&mfConditionalFields("#luciditi_aa_options_form",{rules:"inline",dynamic:!0,unsetHidden:!1,disableHidden:!0,debug:!1,depth:3});0<o("#post").length&&mfConditionalFields("form#post",{rules:"inline",dynamic:!0,unsetHidden:!1,disableHidden:!0,debug:!1,depth:3});0<o("#edittag").length&&mfConditionalFields("form#edittag",{rules:"inline",dynamic:!0,unsetHidden:!1,disableHidden:!0,debug:!1,depth:3})}},addAccessRule:function(){let i=o("#luciditi_aa_access_rules"),e=o(this).closest("td").find("template").html(),t=o(i).find(".luciditi_aa_access_rule").length,l=o(i).find(".luciditi_aa_access_rule"),c=o(l).first().clone(),a=!0;o(l).each(function(){var i=o(this).find(".luciditi_country_select").val();void 0!==i&&""!=i||(a=!1)});if(!1===a)alert("Please select a country for the existing rule(s) before adding new ones.");else{n.updateAccessRuleIndexes(c,t);o(c).find(".luciditi_state_select").hide();o(c).find(".luciditi_state_select").val("");o(c).find(".luciditi_region_select").hide();o(c).find(".luciditi_region_select").val("");o(c).find(".luciditi_country_select").val("");o(c).find(".luciditi_rule_select").val(o(c).find(".luciditi_rule_select option:first").val());o(c).append(e);o(c).appendTo(i);n.updateCountryAndStateAndRegionAvailability();1<o(i).find(".luciditi_aa_access_rule").length&&o("#luciditi_aa_reset_rules").show()}},resetAccessRules:function(){var i=o("#luciditi_aa_access_rules"),e=o(i).find(".luciditi_aa_access_rule").first();o(i).find(".luciditi_aa_access_rule:not(:first)").remove();e.find(".luciditi_country_select").val("");e.find(".luciditi_state_select").hide().val("");e.find(".luciditi_region_select").hide().val("");e.find(".luciditi_rule_select").val(e.find(".luciditi_rule_select option:first").val());o("#luciditi_aa_reset_rules").hide();let t=new Event("change",{bubbles:!0});document.querySelectorAll(".luciditi_country_select").forEach(i=>i.dispatchEvent(t))},validateAccessRules:function(i){let e=o("#luciditi_aa_access_rules"),t=o(e).find(".luciditi_aa_access_rule"),l=o('input[name="luciditi_aa_geolocation_enabled"]').is(":checked"),c=!0;if(l){o(t).each(function(i){var e=o(this).find(".luciditi_country_select").val();if(""===e||void 0===e)return c=!1});if(!c){i.preventDefault();alert("Please select a country for the existing access rules before saving.")}}},updateStateAndRegionVisibility:function(){var i=o(this).val(),e=o(this).closest(".luciditi_aa_access_rule").find(".luciditi_state_select"),t=o(this).closest(".luciditi_aa_access_rule").find(".luciditi_region_select");o(e).hide();o(t).hide();"US"!==i&&"GB"!==i||o("US"===i?e:t).show()},updateCountryAndStateAndRegionAvailability:function(){let n={},s={},d={};o(".luciditi_country_select option, .luciditi_state_select option, .luciditi_region_select option").prop("disabled",!1);o("#luciditi_aa_access_rules .luciditi_aa_access_rule").each(function(){var i=o(this).find(".luciditi_country_select").val(),e=o(this).find(".luciditi_state_select").val(),t=o(this).find(".luciditi_region_select").val();"US"===i&&e?s[e]=!0:"GB"===i&&t?d[t]=!0:i&&(n[i]=!0)});let u=o(".luciditi_state_select:first option").length-1,_=o(".luciditi_region_select:first option").length-1;0==u&&(n.US=!0);0==_&&(n.GB=!0);o("#luciditi_aa_access_rules .luciditi_aa_access_rule").each(function(){var i=o(this).find(".luciditi_country_select");let l=i.val();var e=o(this).find(".luciditi_state_select");let c=e.val();var t=o(this).find(".luciditi_region_select");let a=t.val();if("US"===l){let l=0<Object.keys(s).length;e.find("option").each(function(){var i=o(this),e=i.val(),t=s[e]||""===e&&l||""===e&&n.US;e!==c&&i.prop("disabled",t)})}if("GB"===l){let l=0<Object.keys(d).length;t.find("option").each(function(){var i=o(this),e=i.val(),t=d[e]||""===e&&l||""===e&&n.GB;e!==a&&i.prop("disabled",t)})}i.find("option").each(function(){var i=o(this),e=i.val();let t=!1;"US"===e?(""===c&&n.US||Object.keys(s).length===u)&&(t=!0):"GB"===e?(""===a&&n.GB||Object.keys(d).length===_)&&(t=!0):t=n[e];e!==l&&i.prop("disabled",t)})})},updateAccessRuleIndexes:function(i,e){i.find("select, input").each(function(){var i=o(this).attr("name");if(i){i=i.replace(/\[\d+\]/,"["+e+"]");o(this).attr("name",i)}})}};jQuery(window).ready(function(i){n.init()})}(jQuery);